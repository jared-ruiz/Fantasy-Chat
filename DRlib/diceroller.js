**
 * @dice-roller/rpg-dice-roller - An advanced JS based dice roller that can roll various types of dice and modifiers, along with mathematical equations.
 * 
 * @version 5.1.0
 * @license MIT
 * @author GreenImp Media <info@greenimp.co.uk> (http://greenimp.co.uk)
 * @link https://dice-roller.github.io/documentation
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("mathjs"),require("random-js")):"function"==typeof define&&define.amd?define(["exports","mathjs","random-js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).rpgDiceRoller={},t.math,t.Random)}(this,(function(t,e,r){"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}function u(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function h(t,e,r){return h=f()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&l(o,r.prototype),o},h.apply(null,arguments)}function p(t){var e="function"==typeof Map?new Map:void 0;return p=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return h(t,arguments,c(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,t)},p(t)}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}function v(t){var e=f();return function(){var r,n=c(t);if(e){var o=c(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return m(this,r)}}function d(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}function g(){return g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=d(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},g.apply(this,arguments)}function b(t,e,r,n){return b="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,r,n){var o,i=d(t,e);if(i){if((o=Object.getOwnPropertyDescriptor(i,e)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,e)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,e,o)}else u(n,e,r);return!0},b(t,e,r,n)}function w(t,e,r,n,o){if(!b(t,e,r,n||t)&&o)throw new Error("failed to set property");return r}function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||A(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t){return function(t){if(Array.isArray(t))return E(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||A(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){if(t){if("string"==typeof t)return E(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(t,e):void 0}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),n=e.call(this,'Operator "'.concat(t,'" is invalid')),TypeError.captureStackTrace&&TypeError.captureStackTrace(y(n),r),n.name="CompareOperatorError",n.operator=t,n}return r}(p(TypeError)),O=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),n=e.call(this,"Invalid data format: ".concat(t)),Error.captureStackTrace&&Error.captureStackTrace(y(n),r),n.name="ImportError",n.data=t,n}return r}(p(Error)),T=function(t){s(r,t);var e=v(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(this,r),n=e.call(this,'Die "'.concat(t,'" must have more than 1 possible value to ').concat(i||"do this action")),Error.captureStackTrace&&Error.captureStackTrace(y(n),r),n.name="DieActionValueError",n.action=i,n.die=t,n}return r}(p(Error)),C=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),n=e.call(this,'Notation "'.concat(t,'" is invalid')),Error.captureStackTrace&&Error.captureStackTrace(y(n),r),n.name="NotationError",n.notation=t,n}return r}(p(Error)),R=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return o(this,r),t=e.call(this,"Missing argument".concat(n?' "'.concat(n,'"'):"")),Error.captureStackTrace&&Error.captureStackTrace(y(t),r),t.argumentName=n,t}return r}(p(Error)),N=Object.freeze({__proto__:null,CompareOperatorError:x,DataFormatError:O,DieActionValueError:T,NotationError:C,RequiredArgumentError:R}),j=function(t){return e.evaluate(t)},P=function(t){return("number"==typeof t||"string"==typeof t)&&(!Number.isNaN(t)&&Number.isFinite(Number(t)))},M=function(t){if(!P(t))return!1;var e=Number(t);return e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER},F=Symbol("engine"),J=Symbol("random"),_={browserCrypto:r.browserCrypto,nodeCrypto:r.nodeCrypto,MersenneTwister19937:r.MersenneTwister19937,nativeMath:r.nativeMath,min:{next:function(){return 0}},max:{range:[],next:function(){return this.range[1]-this.range[0]}}},I=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.nativeMath;o(this,t),this.engine=e||r.nativeMath}return a(t,[{key:"engine",get:function(){return this[F]},set:function(t){if(t&&"function"!=typeof t.next)throw new TypeError("engine must have function `next()`");this[F]=t||r.nativeMath,this[J]=new r.Random(this[F])}},{key:"integer",value:function(t,e){return this[F].range=[t,e],this[J].integer(t,e)}},{key:"real",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this[F].range=[t,e],this[J].real(t,e,r)}}]),t}(),q=new I,V=Object.freeze({__proto__:null,engines:_,generator:q}),D=Symbol("operator"),B=Symbol("value"),G=function(){function t(e,r){if(o(this,t),!e)throw new R("operator");if(!r&&0!==r)throw new R("value");this.operator=e,this.value=r}return a(t,[{key:"operator",get:function(){return this[D]},set:function(t){if(!this.constructor.isValidOperator(t))throw new x(t);this[D]=t}},{key:"value",get:function(){return this[B]},set:function(t){if(!P(t))throw new TypeError("value must be a finite number");this[B]=Number(t)}},{key:"isMatch",value:function(t){return function(t,e,r){var n,o=Number(t),i=Number(e);if(Number.isNaN(o)||Number.isNaN(i))return!1;switch(r){case"=":case"==":n=o===i;break;case"<":n=o<i;break;case">":n=o>i;break;case"<=":n=o<=i;break;case">=":n=o>=i;break;case"!":case"!=":case"<>":n=o!==i;break;default:n=!1}return n}(t,this.value,this.operator)}},{key:"toJSON",value:function(){return{operator:this.operator,type:"compare-point",value:this.value}}},{key:"toString",value:function(){return"".concat(this.operator).concat(this.value)}}],[{key:"isValidOperator",value:function(t){return"string"==typeof t&&/^(?:[<>!]?=|[<>]|<>)$/.test(t)}}]),t}(),z=function(){function t(){o(this,t),this.order=999}return a(t,[{key:"name",get:function(){return"modifier"}},{key:"notation",get:function(){return""}},{key:"maxIterations",get:function(){return 1e3}},{key:"run",value:function(t,e){return t}},{key:"toJSON",value:function(){var t=this.notation;return{name:this.name,notation:t,type:"modifier"}}},{key:"toString",value:function(){return this.notation}}]),t}(),U=Symbol("compare-point"),$=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),n=e.call(this),t&&(n.comparePoint=t),n}return a(r,[{key:"comparePoint",get:function(){return this[U]},set:function(t){if(!(t instanceof G))throw new TypeError("comparePoint must be instance of ComparePoint");this[U]=t}},{key:"name",get:function(){return"comparison"}},{key:"notation",get:function(){return"".concat(this.comparePoint||"")}},{key:"isComparePoint",value:function(t){return!!this.comparePoint&&this.comparePoint.isMatch(t)}},{key:"toJSON",value:function(){var t=this.comparePoint;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{comparePoint:t})}}]),r}(z),K=Symbol("compound"),L=Symbol("penetrate"),X=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o(this,r),(t=e.call(this,n))[K]=!!i,t[L]=!!a,t.order=3,t}return a(r,[{key:"compound",get:function(){return this[K]}},{key:"name",get:function(){return"explode"}},{key:"notation",get:function(){return"!".concat(this.compound?"!":"").concat(this.penetrate?"p":"").concat(g(c(r.prototype),"notation",this))}},{key:"penetrate",get:function(){return this[L]}},{key:"run",value:function(t,e){var r=this;if(e.min===e.max)throw new T(e,"explode");var n=t;return n.rolls=t.rolls.map((function(t){for(var n,o=[t],i=t.value,a=0;a<r.maxIterations&&r.isComparePoint(i);a++){var u=o[o.length-1],s=e.rollOnce();i=s.value,u.modifiers.add("explode"),r.penetrate&&(u.modifiers.add("penetrate"),s.value-=1),o.push(s)}return r.compound&&o.length>1?(t.value=(n=o.map((function(t){return t.value})),Array.isArray(n)?n.reduce((function(t,e){return t+(P(e)?parseFloat("".concat(e)):0)}),0):0),t.modifiers=["explode","compound"],r.penetrate&&t.modifiers.add("penetrate"),t):o})).flat(),n}},{key:"toJSON",value:function(){var t=this.compound,e=this.penetrate;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{compound:t,penetrate:e})}}]),r}($),H={compound:"!",explode:"!","critical-failure":"__","critical-success":"**",drop:"d",max:"v",min:"^",penetrate:"p","re-roll":"r","re-roll-once":"ro","target-failure":"_","target-success":"*"},Q=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return[].concat(e).reduce((function(t,e){var r;return r=e instanceof z?e.name:e,t+(H[r]||r)}),"")},W=Symbol("calculation-value"),Y=Symbol("modifiers"),Z=Symbol("initial-value"),tt=Symbol("use-in-total"),et=Symbol("value"),rt=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(o(this,t),P(e))this[Z]=Number(e),this.modifiers=r||[],this.useInTotal=i;else{if(!e||"object"!==n(e)||Array.isArray(e))throw e===1/0?new RangeError("Result value must be a finite number"):new TypeError("Result value is invalid: ".concat(e));var a=P(e.initialValue)?e.initialValue:e.value;if(!P(a))throw new TypeError("Result value is invalid: ".concat(a));this[Z]=Number(a),P(e.value)&&Number(e.value)!==this[Z]&&(this.value=e.value),P(e.calculationValue)&&parseFloat("".concat(e.calculationValue))!==this.value&&(this.calculationValue=e.calculationValue),this.modifiers=e.modifiers||r||[],this.useInTotal="boolean"==typeof e.useInTotal?e.useInTotal:i||!1}}return a(t,[{key:"calculationValue",get:function(){return P(this[W])?parseFloat(this[W]):this.value},set:function(t){var e=P(t);if(t===1/0)throw new RangeError("Result calculation value must be a finite number");if(t&&!e)throw new TypeError("Result calculation value is invalid: ".concat(t));this[W]=e?parseFloat("".concat(t)):null}},{key:"initialValue",get:function(){return this[Z]}},{key:"modifierFlags",get:function(){return Q.apply(void 0,S(this.modifiers))}},{key:"modifiers",get:function(){return this[Y]},set:function(t){if((Array.isArray(t)||t instanceof Set)&&S(t).every((function(t){return"string"==typeof t})))this[Y]=new Set(S(t));else{if(t||0===t)throw new TypeError("modifiers must be a Set or array of modifier names: ".concat(t));this[Y]=new Set}}},{key:"useInTotal",get:function(){return!!this[tt]},set:function(t){this[tt]=!!t}},{key:"value",get:function(){return P(this[et])?this[et]:this[Z]},set:function(t){if(t===1/0)throw new RangeError("Result value must be a finite number");if(!P(t))throw new TypeError("Result value is invalid: ".concat(t));this[et]=Number(t)}},{key:"toJSON",value:function(){var t=this.calculationValue,e=this.initialValue,r=this.modifierFlags,n=this.modifiers,o=this.useInTotal,i=this.value;return{calculationValue:t,initialValue:e,modifierFlags:r,modifiers:S(n),type:"result",useInTotal:o,value:i}}},{key:"toString",value:function(){return this.value+this.modifierFlags}}]),t}(),nt=Symbol("rolls"),ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];o(this,t),this.rolls=e}return a(t,[{key:"length",get:function(){return this.rolls.length||0}},{key:"rolls",get:function(){return S(this[nt])},set:function(t){var e=this;if(!t||!Array.isArray(t))throw new TypeError("rolls must be an array: ".concat(t));this[nt]=[],t.forEach((function(t){e.addRoll(t)}))}},{key:"value",get:function(){return this.rolls.reduce((function(t,e){return t+(e.useInTotal?e.calculationValue:0)}),0)}},{key:"addRoll",value:function(t){var e=t instanceof rt?t:new rt(t);this[nt].push(e)}},{key:"toJSON",value:function(){return{rolls:this.rolls,type:"roll-results",value:this.value}}},{key:"toString",value:function(){return"[".concat(this.rolls.join(", "),"]")}}]),t}(),it=Symbol("once"),at=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(this,r),(t=e.call(this,i)).once=!!n,t.order=4,t}return a(r,[{key:"name",get:function(){return"re-roll"}},{key:"notation",get:function(){return"r".concat(this.once?"o":"").concat(g(c(r.prototype),"notation",this))}},{key:"once",get:function(){return!!this[it]},set:function(t){this[it]=!!t}},{key:"run",value:function(t,e){var r=this;if(e.min===e.max)throw new T(e,"re-roll");return t.rolls.map((function(t){for(var n=0;n<r.maxIterations&&r.isComparePoint(t.value);n++){var o=e.rollOnce();if(t.value=o.value,t.modifiers.add("re-roll".concat(r.once?"-once":"")),r.once)break}return t})),t}},{key:"toJSON",value:function(){var t=this.once;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{once:t})}}]),r}($),ut=Symbol("modifiers"),st=Symbol("qty"),ct=Symbol("sides"),lt=Symbol("min-value"),ft=Symbol("max-value"),ht=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(o(this,t),!e&&0!==e)throw new R("sides");if(e===1/0)throw new RangeError("numerical sides must be finite number");if(P(e)){if(e<1||!M(e))throw new RangeError("numerical sides must be a positive finite number")}else if("string"!=typeof e)throw new TypeError("non-numerical sides must be a string");if(!P(r))throw new TypeError("qty must be a positive finite integer");if(r<1||r>999)throw new RangeError("qty must be between 1 and 999");if(!P(i))throw new TypeError("min must a finite number");if(!M(i))throw new RangeError("min must a finite number");if(a&&!P(a))throw new TypeError("max must a finite number");if(a&&!M(a))throw new RangeError("max must a finite number");this[st]=parseInt("".concat(r),10),this[ct]=e,n&&(this.modifiers=n),this[lt]=parseInt(i,10),this[ft]=a?parseInt("".concat(a),10):e}return a(t,[{key:"average",get:function(){return(this.min+this.max)/2}},{key:"modifiers",get:function(){return this[ut]?new Map(S(this[ut]).sort((function(t,e){return t[1].order-e[1].order}))):null},set:function(t){var e,r=this;if(t instanceof Map)e=t;else if(Array.isArray(t))e=new Map(t.map((function(t){return[t.name,t]})));else{if("object"!==n(t))throw new TypeError("modifiers should be a Map, array, or an Object containing Modifiers");e=new Map(Object.entries(t))}if(e.size&&S(e.entries()).some((function(t){return!(t[1]instanceof z)})))throw new TypeError("modifiers must only contain Modifier instances");this[ut]=e,this[ut].forEach((function(t){t instanceof X&&!t.comparePoint?t.comparePoint=new G("=",r.max):t instanceof at&&!t.comparePoint&&(t.comparePoint=new G("=",r.min))}))}},{key:"max",get:function(){return this[ft]}},{key:"min",get:function(){return this[lt]}},{key:"name",get:function(){return"standard"}},{key:"notation",get:function(){var t="".concat(this.qty,"d").concat(this.sides);return this.modifiers&&this.modifiers.size&&(t+=S(this.modifiers.values()).reduce((function(t,e){return t+e.notation}),"")),t}},{key:"qty",get:function(){return this[st]}},{key:"sides",get:function(){return this[ct]}},{key:"roll",value:function(){for(var t=this,e=new ot,r=0;r<this.qty;r++)e.addRoll(this.rollOnce());return(this.modifiers||[]).forEach((function(r){r.run(e,t)})),e}},{key:"rollOnce",value:function(){return new rt(q.integer(this.min,this.max))}},{key:"toJSON",value:function(){return{average:this.average,max:this.max,min:this.min,modifiers:this.modifiers,name:this.name,notation:this.notation,qty:this.qty,sides:this.sides,type:"die"}}},{key:"toString",value:function(){return this.notation}}]),t}(),pt=function(t){s(r,t);var e=v(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o(this,r);var a=t;if(a||0===a){if(1!==a&&2!==a)throw new RangeError("nonBlanks must be 1 or 2")}else a=2;return e.call(this,a,n,i,-1,1)}return a(r,[{key:"name",get:function(){return"fudge"}},{key:"nonBlanks",get:function(){return g(c(r.prototype),"sides",this)}},{key:"sides",get:function(){return"F.".concat(this.nonBlanks)}},{key:"rollOnce",value:function(){var t=0;if(2===this.nonBlanks)t=q.integer(1,3)-2;else if(1===this.nonBlanks){var e=q.integer(1,6);1===e?t=-1:6===e&&(t=1)}return new rt(t)}}]),r}(ht),yt=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o(this,r),(t=e.call(this,100,n,i)).sidesAsNumber=!!a,t}return a(r,[{key:"name",get:function(){return"percentile"}},{key:"sides",get:function(){return this.sidesAsNumber?g(c(r.prototype),"sides",this):"%"}}]),r}(ht),mt=Object.freeze({__proto__:null,FudgeDice:pt,PercentileDice:yt,StandardDice:ht}),vt=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),(n=e.call(this,t)).order=9,n}return a(r,[{key:"name",get:function(){return"critical-failure"}},{key:"notation",get:function(){return"cf".concat(g(c(r.prototype),"notation",this))}},{key:"run",value:function(t,e){var r=this;return t.rolls.forEach((function(t){return r.isComparePoint(t.value)&&t.modifiers.add("critical-failure"),t})),t}}]),r}($),dt=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),(n=e.call(this,t)).order=8,n}return a(r,[{key:"name",get:function(){return"critical-success"}},{key:"notation",get:function(){return"cs".concat(g(c(r.prototype),"notation",this))}},{key:"run",value:function(t,e){var r=this;return t.rolls.forEach((function(t){return r.isComparePoint(t.value)&&t.modifiers.add("critical-success"),t})),t}}]),r}($),gt=Symbol("calculation-value"),bt=Symbol("is-roll-group"),wt=Symbol("modifiers"),kt=Symbol("results"),St=Symbol("use-in-total"),At=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];o(this,t),this.isRollGroup=n,this.modifiers=r,this.results=e,this.useInTotal=i}return a(t,[{key:"calculationValue",get:function(){return P(this[gt])?parseFloat(this[gt]):this.value},set:function(t){var e=P(t);if(t===1/0)throw new RangeError("Results calculation value must be a finite number");if(t&&!e)throw new TypeError("Results calculation value is invalid: ".concat(t));this[gt]=e?parseFloat("".concat(t)):null}},{key:"isRollGroup",get:function(){return this[bt]},set:function(t){this[bt]=!!t}},{key:"length",get:function(){return this.results.length||0}},{key:"modifierFlags",get:function(){return Q.apply(void 0,S(this.modifiers))}},{key:"modifiers",get:function(){return this[wt]},set:function(t){if((Array.isArray(t)||t instanceof Set)&&S(t).every((function(t){return"string"==typeof t})))this[wt]=new Set(S(t));else{if(t||0===t)throw new TypeError("modifiers must be a Set or array of modifier names: ".concat(t));this[wt]=new Set}}},{key:"results",get:function(){return S(this[kt])},set:function(t){var e=this;if(!t||!Array.isArray(t))throw new TypeError("results must be an array: ".concat(t));this[kt]=[],t.forEach((function(t){e.addResult(t)}))}},{key:"useInTotal",get:function(){return!!this[St]},set:function(t){this[St]=!!t}},{key:"value",get:function(){if(!this.results.length)return 0;var e=this.results.reduce((function(e,r){var n=r;return r instanceof t?n=r.useInTotal?r.calculationValue:0:r instanceof ot&&(n=r.value),e+n}),"string"==typeof this.results[0]?"":0);return"string"==typeof e?j(e):e}},{key:"addResult",value:function(e){var r;if(e instanceof t||e instanceof ot)r=e;else{if("string"!=typeof e&&!P(e))throw new TypeError("value must be one of ResultGroup, RollResults, string, or number");r=e}this[kt].push(r)}},{key:"toJSON",value:function(){var t=this.calculationValue,e=this.isRollGroup,r=this.modifierFlags,n=this.modifiers,o=this.results,i=this.useInTotal,a=this.value;return{calculationValue:t,isRollGroup:e,modifierFlags:r,modifiers:S(n),results:o,type:"result-group",useInTotal:i,value:a}}},{key:"toString",value:function(){var t;return t=this.isRollGroup?"{".concat(this.results.join(", "),"}"):this.results.join(""),this.modifierFlags&&(t="(".concat(t,")").concat(this.modifierFlags)),t}}]),t}(),Et=Symbol("end"),xt=Symbol("qty"),Ot=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"h",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return o(this,r),(t=e.call(this)).end=n,t.qty=i,t.order=5,t}return a(r,[{key:"end",get:function(){return this[Et]},set:function(t){if("h"!==t&&"l"!==t)throw new RangeError('End must be "h" or "l"');this[Et]=t}},{key:"name",get:function(){return"keep-".concat(this.end)}},{key:"notation",get:function(){return"k".concat(this.end).concat(this.qty)}},{key:"qty",get:function(){return this[xt]},set:function(t){if(t===1/0)throw new RangeError("qty must be a finite number");if(!P(t)||t<1)throw new TypeError("qty must be a positive finite integer");this[xt]=Math.floor(t)}},{key:"rangeToDrop",value:function(t){return"h"===this.end?[0,t.length-this.qty]:[this.qty,t.length]}},{key:"run",value:function(t,e){var r,n,o;return o=t instanceof At?1===(n=t.results).length&&n[0]instanceof At?n[0].results.map((function(t,e){return t instanceof ot?t.rolls.map((function(t,r){return{value:t.value,index:[e,r]}})):null})).flat().filter(Boolean):S(n).map((function(t,e){return{value:t.value,index:e}})):S(n=t.rolls).map((function(t,e){return{value:t.value,index:e}})),(o=(r=o.sort((function(t,e){return t.value-e.value})).map((function(t){return t.index}))).slice.apply(r,S(this.rangeToDrop(o)))).forEach((function(t){var e;(e=Array.isArray(t)?n[0].results[t[0]].rolls[t[1]]:n[t]).modifiers.add("drop"),e.useInTotal=!1})),t}},{key:"toJSON",value:function(){var t=this.end,e=this.qty;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{end:t,qty:e})}}]),r}(z),Tt=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"l",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return o(this,r),(t=e.call(this,n,i)).order=6,t}return a(r,[{key:"name",get:function(){return"drop-".concat(this.end)}},{key:"notation",get:function(){return"d".concat(this.end).concat(this.qty)}},{key:"rangeToDrop",value:function(t){return"h"===this.end?[t.length-this.qty,t.length]:[0,this.qty]}}]),r}(Ot),Ct=Symbol("max"),Rt=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),(n=e.call(this)).max=t,n.order=2,n}return a(r,[{key:"max",get:function(){return this[Ct]},set:function(t){if(!P(t))throw new TypeError("max must be a number");this[Ct]=parseFloat("".concat(t))}},{key:"name",get:function(){return"max"}},{key:"notation",get:function(){return"max".concat(this.max)}},{key:"run",value:function(t,e){var r=this,n=t;return n.rolls=t.rolls.map((function(t){var e=t;return t.value>r.max&&(e.value=r.max,e.modifiers.add("max")),e})),n}},{key:"toJSON",value:function(){var t=this.max;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{max:t})}}]),r}(z),Nt=Symbol("min"),jt=function(t){s(r,t);var e=v(r);function r(t){var n;return o(this,r),(n=e.call(this)).min=t,n.order=1,n}return a(r,[{key:"min",get:function(){return this[Nt]},set:function(t){if(!P(t))throw new TypeError("min must be a number");this[Nt]=parseFloat("".concat(t))}},{key:"name",get:function(){return"min"}},{key:"notation",get:function(){return"min".concat(this.min)}},{key:"run",value:function(t,e){var r=this,n=t;return n.rolls=t.rolls.map((function(t){var e=t;return t.value<r.min&&(e.value=r.min,e.modifiers.add("min")),e})),n}},{key:"toJSON",value:function(){var t=this.min;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{min:t})}}]),r}(z),Pt=Symbol("direction"),Mt=function(t){s(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"a";return o(this,r),(t=e.call(this)).direction=n,t.order=10,t}return a(r,[{key:"direction",get:function(){return this[Pt]},set:function(t){if("a"!==t&&"d"!==t)throw new RangeError('Direction must be "a" (Ascending) or "d" (Descending)');this[Pt]=t}},{key:"name",get:function(){return"sorting"}},{key:"notation",get:function(){return"s".concat(this.direction)}},{key:"run",value:function(t,e){var r,n=this;return t[r=t instanceof At?"results":"rolls"]=t[r].sort((function(t,e){return"d"===n.direction?e.value-t.value:t.value-e.value})),t instanceof At&&(t[r]=t[r].map((function(t){return t instanceof At||t instanceof ot?n.run(t,e):t}))),t}},{key:"toJSON",value:function(){var t=this.direction;return Object.assign(g(c(r.prototype),"toJSON",this).call(this),{direction:t})}}]),r}(z),Ft=Symbol("failure-cp"),Jt=function(t){s(r,t);var e=v(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o(this,r),(n=e.call(this,t)).failureComparePoint=i,n.order=7,n}return a(r,[{key:"failureComparePoint",get:function(){return this[Ft]},set:function(t){if(t&&!(t instanceof G))throw new TypeError("failure comparePoint must be instance of ComparePoint or null");this[Ft]=t||null}},{key:"name",get:function(){return"target"}},{key:"notation",get:function(){return"".concat(g(c(r.prototype),"notation",this)).concat(this.failureComparePoint?"f".concat(this.failureComparePoint):"")}},{key:"successComparePoint",get:function(){return this.comparePoint},set:function(t){w(c(r.prototype),"comparePoint",t,this,!0)}},{key:"getStateValue",value:function(t){return this.isSuccess(t)?1:this.isFailure(t)?-1:0}},{key:"isFailure",value:function(t){return!!this.failureComparePoint&&this.failureComparePoint.isMatch(t)}},{key:"isNeutral",value:function(t){return!this.isSuccess(t)&&!this.isFailure(t)}},{key:"isSuccess",value:function(t){return this.isComparePoint(t)}},{key:"run",value:function(t,e){var r=this;return(t instanceof At?t.results:t.rolls).forEach((function(t){r.isSuccess(t.value)?t.modifiers.add("target-success"):r.isFailure(t.value)&&t.modifiers.add("target-failure"),t.calculationValue=r.getStateValue(t.value)})),t}},{key:"toJSON",value:function(){var t=this.failureComparePoint,e=this.successComparePoint,n=g(c(r.prototype),"toJSON",this).call(this);return delete n.comparePoint,Object.assign(n,{failureComparePoint:t,successComparePoint:e})}}]),r}($),_t=Object.freeze({__proto__:null,ComparisonModifier:$,CriticalFailureModifier:vt,CriticalSuccessModifier:dt,DropModifier:Tt,ExplodeModifier:X,KeepModifier:Ot,MaxModifier:Rt,MinModifier:jt,Modifier:z,ReRollModifier:at,SortingModifier:Mt,TargetModifier:Jt}),It=Object.freeze({__proto__:null,ResultGroup:At,RollResult:rt,RollResults:ot}),qt=function(t){try{return!(!t||btoa(atob(t))!==t)}catch(t){return!1}},Vt=function(t){try{var e=!!t&&JSON.parse(t);return!(!e||"object"!==n(e))}catch(t){return!1}},Dt=Symbol("modifiers"),Bt=Symbol("expressions"),Gt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];o(this,t),this.expressions=e,this.modifiers=r}return a(t,[{key:"expressions",get:function(){return S(this[Bt]||[])},set:function(t){var e=this;if(!t)throw new R("expressions");if(!Array.isArray(t))throw new TypeError("expressions must be an array: ".concat(t));this[Bt]=[],t.forEach((function(r){if(!r||!Array.isArray(r))throw new TypeError("Expressions must be an array of arrays: ".concat(t));if(0===r.length)throw new TypeError("Sub expressions cannot be empty: ".concat(t));if(!r.every((function(t){return t instanceof ht||"string"==typeof t||"number"==typeof t})))throw new TypeError("Sub expression items must be Dice, numbers, or strings");e[Bt].push(r)}))}},{key:"modifiers",get:function(){return this[Dt]?new Map(S(this[Dt]).sort((function(t,e){return t[1].order-e[1].order}))):null},set:function(t){var e;if(t instanceof Map)e=t;else if(Array.isArray(t))e=new Map(t.map((function(t){return[t.name,t]})));else{if("object"!==n(t))throw new TypeError("modifiers should be a Map, array, or an Object containing Modifiers");e=new Map(Object.entries(t))}if(e.size&&S(e.entries()).some((function(t){return!(t[1]instanceof z)})))throw new TypeError("modifiers must only contain Modifier instances");this[Dt]=e}},{key:"notation",get:function(){var t=this.expressions.map((function(t){return t.reduce((function(t,e){return t+e}),"")})).join(", ");return t="{".concat(t,"}"),this.modifiers&&this.modifiers.size&&(t+=S(this.modifiers.values()).reduce((function(t,e){return t+e.notation}),"")),t}},{key:"roll",value:function(){var t=this,e=new At(this.expressions.map((function(t){var e=t.map((function(t){return t instanceof ht?t.roll():t}));return new At(e)})));return e.isRollGroup=!0,(this.modifiers||[]).forEach((function(r){r.run(e,t)})),e}},{key:"toJSON",value:function(){var t=this.modifiers,e=this.notation;return{expressions:this.expressions,modifiers:t,notation:e,type:"group"}}},{key:"toString",value:function(){return this.notation}}]),t}();function zt(t,e,r,n){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,zt.prototype),o.expected=e,o.found=r,o.location=n,o.name="SyntaxError",o}function Ut(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}function $t(t,e){var r,n,o,i,a={},s=(e=void 0!==e?e:{}).grammarSource,c={Main:Se},l=Se,f=",",h="d",p="d%",y="dF",m="!",v="max",d="min",g="cs",b="cf",w="!=",A="<=",E=">=",x="<>",O="(",T=")",C="abs",R="ceil",N="cos",P="exp",M="floor",F="log",J="round",_="sign",I="sin",q="sqrt",V="tan",D="pow",B=/^[12]/,z=/^[lh]/,U=/^[.]/,$=/^[1-9]/,K=/^[0-9]/,L=/^[ \t\n\r]/,H=de("{",!1),Q=de(",",!1),W=de("}",!1),Y=de("d",!1),Z=de("d%",!1),tt=de("dF",!1),et=de(".",!1),rt=ge(["1","2"],!1,!1),nt=de("!",!1),ot=de("p",!1),it=ge(["l","h"],!1,!1),ut=de("k",!1),st=de("max",!1),ct=de("min",!1),lt=de("r",!1),ft=de("o",!1),mt=de("cs",!1),gt=de("cf",!1),bt=de("s",!1),wt=de("a",!1),kt=de("f",!1),St=de("!=",!1),At=de("<=",!1),Et=de(">=",!1),xt=de("=",!1),Ct=de("<>",!1),Nt=de(">",!1),Pt=de("<",!1),Ft=de("(",!1),_t=de(")",!1),It=de("abs",!1),qt=de("ceil",!1),Vt=de("cos",!1),Dt=de("exp",!1),Bt=de("floor",!1),Ut=de("log",!1),$t=de("round",!1),Kt=de("sign",!1),Lt=de("sin",!1),Xt=de("sqrt",!1),Ht=de("tan",!1),Qt=de("pow",!1),Wt=de("-",!1),Yt=ge(["."],!1,!1),Zt=ge([["1","9"]],!1,!1),te=ge([["0","9"]],!1,!1),ee=de("**",!1),re=de("*",!1),ne=de("^",!1),oe=de("%",!1),ie=de("/",!1),ae=de("+",!1),ue={type:"other",description:"whitespace"},se=ge([" ","\t","\n","\r"],!1,!1),ce=function(){return parseInt(ve(),10)},le=0,fe=0,he=[{line:1,column:1}],pe=0,ye=[],me=0;if("startRule"in e){if(!(e.startRule in c))throw new Error("Can't start parsing from rule \""+e.startRule+'".');l=c[e.startRule]}function ve(){return t.substring(fe,le)}function de(t,e){return{type:"literal",text:t,ignoreCase:e}}function ge(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function be(e){var r,n=he[e];if(n)return n;for(r=e-1;!he[r];)r--;for(n={line:(n=he[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return he[e]=n,n}function we(t,e){var r=be(t),n=be(e);return{source:s,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function ke(t){le<pe||(le>pe&&(pe=le,ye=[]),ye.push(t))}function Se(){return Ce()}function Ae(){var e,r,n,o,i,s,c,l,f,h;if(e=le,123===t.charCodeAt(le)?(r="{",le++):(r=a,0===me&&ke(H)),r!==a)if(Fe(),(n=Ce())!==a){for(o=[],i=le,s=Fe(),44===t.charCodeAt(le)?(c=",",le++):(c=a,0===me&&ke(Q)),c!==a?(l=Fe(),(f=Ce())!==a?i=s=[s,c,l,f]:(le=i,i=a)):(le=i,i=a);i!==a;)o.push(i),i=le,s=Fe(),44===t.charCodeAt(le)?(c=",",le++):(c=a,0===me&&ke(Q)),c!==a?(l=Fe(),(f=Ce())!==a?i=s=[s,c,l,f]:(le=i,i=a)):(le=i,i=a);if(i=Fe(),125===t.charCodeAt(le)?(s="}",le++):(s=a,0===me&&ke(W)),s!==a){for(c=[],l=xe();l!==a;)c.push(l),l=xe();fe=e,h=c,e=new Gt([n].concat(S(o.map((function(t){return t[3]})))),Object.assign.apply(Object,[{}].concat(S(h.map((function(t){return u({},t.name,t)}))))))}else le=e,e=a}else le=e,e=a;else le=e,e=a;return e}function Ee(){var e,r,n,o,i,s;if(e=le,r=function(){var e,r,n,o;e=le,(r=Te())===a&&(r=null);100===t.charCodeAt(le)?(n=h,le++):(n=a,0===me&&ke(Y));n!==a&&(o=Te())!==a?(fe=e,e=new ht(o,r||1)):(le=e,e=a);return e}(),r===a&&(r=function(){var e,r,n;e=le,(r=Te())===a&&(r=null);t.substr(le,2)===p?(n=p,le+=2):(n=a,0===me&&ke(Z));n!==a?(fe=e,e=new yt(r||1)):(le=e,e=a);return e}(),r===a&&(r=function(){var e,r,n,o,i,u;e=le,(r=Te())===a&&(r=null);t.substr(le,2)===y?(n=y,le+=2):(n=a,0===me&&ke(tt));n!==a?(o=le,46===t.charCodeAt(le)?(i=".",le++):(i=a,0===me&&ke(et)),i!==a?(B.test(t.charAt(le))?(u=t.charAt(le),le++):(u=a,0===me&&ke(rt)),u!==a?o=i=[i,u]:(le=o,o=a)):(le=o,o=a),o===a&&(o=null),fe=e,s=r,e=new pt((c=o)?parseInt(c[1],10):2,s||1)):(le=e,e=a);var s,c;return e}())),r!==a){for(n=[],o=xe();o!==a;)n.push(o),o=xe();fe=e,s=n,(i=r).modifiers=Object.assign.apply(Object,[{}].concat(S(s.map((function(t){return u({},t.name,t)}))))),e=i}else le=e,e=a;return e}function xe(){var e;return(e=function(){var e,r,n,o,i;e=le,33===t.charCodeAt(le)?(r=m,le++):(r=a,0===me&&ke(nt));r!==a?(33===t.charCodeAt(le)?(n=m,le++):(n=a,0===me&&ke(nt)),n===a&&(n=null),112===t.charCodeAt(le)?(o="p",le++):(o=a,0===me&&ke(ot)),o===a&&(o=null),(i=Oe())===a&&(i=null),fe=e,e=new X(i,!!n,!!o)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n;e=le,(r=Oe())!==a?(n=function(){var e,r,n;e=le,102===t.charCodeAt(le)?(r="f",le++):(r=a,0===me&&ke(kt));r!==a&&(n=Oe())!==a?(fe=e,e=n):(le=e,e=a);return e}(),n===a&&(n=null),fe=e,e=new Jt(r,n)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n,o;e=le,100===t.charCodeAt(le)?(r=h,le++):(r=a,0===me&&ke(Y));r!==a?(z.test(t.charAt(le))?(n=t.charAt(le),le++):(n=a,0===me&&ke(it)),n===a&&(n=null),(o=je())!==a?(fe=e,e=new Tt(n||"l",o)):(le=e,e=a)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n,o;e=le,107===t.charCodeAt(le)?(r="k",le++):(r=a,0===me&&ke(ut));r!==a?(z.test(t.charAt(le))?(n=t.charAt(le),le++):(n=a,0===me&&ke(it)),n===a&&(n=null),(o=je())!==a?(fe=e,e=new Ot(n||"h",o)):(le=e,e=a)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n,o;e=le,114===t.charCodeAt(le)?(r="r",le++):(r=a,0===me&&ke(lt));r!==a?(111===t.charCodeAt(le)?(n="o",le++):(n=a,0===me&&ke(ft)),n===a&&(n=null),(o=Oe())===a&&(o=null),fe=e,e=new at(!!n,o)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n;e=le,t.substr(le,2)===g?(r=g,le+=2):(r=a,0===me&&ke(mt));r!==a&&(n=Oe())!==a?(fe=e,e=new dt(n)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n;e=le,t.substr(le,2)===b?(r=b,le+=2):(r=a,0===me&&ke(gt));r!==a&&(n=Oe())!==a?(fe=e,e=new vt(n)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n;e=le,115===t.charCodeAt(le)?(r="s",le++):(r=a,0===me&&ke(bt));r!==a?(97===t.charCodeAt(le)?(n="a",le++):(n=a,0===me&&ke(wt)),n===a&&(100===t.charCodeAt(le)?(n=h,le++):(n=a,0===me&&ke(Y))),n===a&&(n=null),fe=e,e=new Mt(n||"a")):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n;e=le,t.substr(le,3)===v?(r=v,le+=3):(r=a,0===me&&ke(st));r!==a&&(n=Ne())!==a?(fe=e,e=new Rt(n)):(le=e,e=a);return e}())===a&&(e=function(){var e,r,n;e=le,t.substr(le,3)===d?(r=d,le+=3):(r=a,0===me&&ke(ct));r!==a&&(n=Ne())!==a?(fe=e,e=new jt(n)):(le=e,e=a);return e}()),e}function Oe(){var e,r,n;return e=le,r=function(){var e;t.substr(le,2)===w?(e=w,le+=2):(e=a,0===me&&ke(St));e===a&&(t.substr(le,2)===A?(e=A,le+=2):(e=a,0===me&&ke(At)),e===a&&(t.substr(le,2)===E?(e=E,le+=2):(e=a,0===me&&ke(Et)),e===a&&(61===t.charCodeAt(le)?(e="=",le++):(e=a,0===me&&ke(xt)),e===a&&(t.substr(le,2)===x?(e=x,le+=2):(e=a,0===me&&ke(Ct)),e===a&&(62===t.charCodeAt(le)?(e=">",le++):(e=a,0===me&&ke(Nt)),e===a&&(60===t.charCodeAt(le)?(e="<",le++):(e=a,0===me&&ke(Pt))))))));return e}(),r!==a&&(n=Ne())!==a?(fe=e,e=new G(r,n)):(le=e,e=a),e}function Te(){var e,r,n,o,i,u,s,c,l,f;if((e=je())===a)if(e=le,40===t.charCodeAt(le)?(r=O,le++):(r=a,0===me&&ke(Ft)),r!==a){if(Fe(),n=le,(o=Ne())!==a){if(i=[],u=le,s=Fe(),(c=Me())!==a?(l=Fe(),(f=Ne())!==a?u=s=[s,c,l,f]:(le=u,u=a)):(le=u,u=a),u!==a)for(;u!==a;)i.push(u),u=le,s=Fe(),(c=Me())!==a?(l=Fe(),(f=Ne())!==a?u=s=[s,c,l,f]:(le=u,u=a)):(le=u,u=a);else i=a;i!==a?n=o=[o,i]:(le=n,n=a)}else le=n,n=a;n!==a?(o=Fe(),41===t.charCodeAt(le)?(i=T,le++):(i=a,0===me&&ke(_t)),i!==a?(fe=e,e=j(ve())):(le=e,e=a)):(le=e,e=a)}else le=e,e=a;return e}function Ce(){var t,e,r,n,o,i,u,s,c,l;if(t=le,(e=Re())!==a){for(r=[],n=le,o=Fe(),(i=Me())!==a?(u=Fe(),(s=Re())!==a?n=o=[o,i,u,s]:(le=n,n=a)):(le=n,n=a);n!==a;)r.push(n),n=le,o=Fe(),(i=Me())!==a?(u=Fe(),(s=Re())!==a?n=o=[o,i,u,s]:(le=n,n=a)):(le=n,n=a);fe=t,c=e,l=r,c=Array.isArray(c)?c:[c],t=[].concat(S(c),S(l.map((function(t){var e=k(t,4);return[e[1],e[3]]})).flat(2)))}else le=t,t=a;return t}function Re(){var e,r,n,o,i;return e=function(){var e,r,n,o,i,u,s;e=le,t.substr(le,3)===C?(r=C,le+=3):(r=a,0===me&&ke(It));r===a&&(t.substr(le,4)===R?(r=R,le+=4):(r=a,0===me&&ke(qt)),r===a&&(t.substr(le,3)===N?(r=N,le+=3):(r=a,0===me&&ke(Vt)),r===a&&(t.substr(le,3)===P?(r=P,le+=3):(r=a,0===me&&ke(Dt)),r===a&&(t.substr(le,5)===M?(r=M,le+=5):(r=a,0===me&&ke(Bt)),r===a&&(t.substr(le,3)===F?(r=F,le+=3):(r=a,0===me&&ke(Ut)),r===a&&(t.substr(le,5)===J?(r=J,le+=5):(r=a,0===me&&ke($t)),r===a&&(t.substr(le,4)===_?(r=_,le+=4):(r=a,0===me&&ke(Kt)),r===a&&(t.substr(le,3)===I?(r=I,le+=3):(r=a,0===me&&ke(Lt)),r===a&&(t.substr(le,4)===q?(r=q,le+=4):(r=a,0===me&&ke(Xt)),r===a&&(t.substr(le,3)===V?(r=V,le+=3):(r=a,0===me&&ke(Ht))))))))))));r!==a?(40===t.charCodeAt(le)?(n=O,le++):(n=a,0===me&&ke(Ft)),n!==a?(Fe(),(o=Ce())!==a?(Fe(),41===t.charCodeAt(le)?(i=T,le++):(i=a,0===me&&ke(_t)),i!==a?(fe=e,c=o,e=["".concat(r,"(")].concat(S(c),[")"])):(le=e,e=a)):(le=e,e=a)):(le=e,e=a)):(le=e,e=a);var c;e===a&&(e=le,t.substr(le,3)===D?(r=D,le+=3):(r=a,0===me&&ke(Qt)),r===a&&(t.substr(le,3)===v?(r=v,le+=3):(r=a,0===me&&ke(st)),r===a&&(t.substr(le,3)===d?(r=d,le+=3):(r=a,0===me&&ke(ct)))),r!==a?(40===t.charCodeAt(le)?(n=O,le++):(n=a,0===me&&ke(Ft)),n!==a?(Fe(),(o=Ce())!==a?(Fe(),44===t.charCodeAt(le)?(i=f,le++):(i=a,0===me&&ke(Q)),i!==a?(Fe(),(u=Ce())!==a?(Fe(),41===t.charCodeAt(le)?(s=T,le++):(s=a,0===me&&ke(_t)),s!==a?(fe=e,e=function(t,e,r){return["".concat(t,"(")].concat(S(e),[","],S(r),[")"])}(r,o,u)):(le=e,e=a)):(le=e,e=a)):(le=e,e=a)):(le=e,e=a)):(le=e,e=a)):(le=e,e=a));return e}(),e===a&&(e=Ee())===a&&(e=Ne())===a&&(e=le,40===t.charCodeAt(le)?(r=O,le++):(r=a,0===me&&ke(Ft)),r!==a?(Fe(),(n=Ce())!==a?(Fe(),41===t.charCodeAt(le)?(o=T,le++):(o=a,0===me&&ke(_t)),o!==a?(fe=e,i=o,e=[r].concat(S(n),[i])):(le=e,e=a)):(le=e,e=a)):(le=e,e=a),e===a&&(e=Ae())),e}function Ne(){var e,r,n,o;return e=le,45===t.charCodeAt(le)?le++:0===me&&ke(Wt),Pe()!==a?(r=le,U.test(t.charAt(le))?(n=t.charAt(le),le++):(n=a,0===me&&ke(Yt)),n!==a&&(o=Pe())!==a?r=n=[n,o]:(le=r,r=a),r===a&&(r=null),fe=e,e=parseFloat(ve())):(le=e,e=a),e}function je(){var e,r,n,o;if(e=le,$.test(t.charAt(le))?(r=t.charAt(le),le++):(r=a,0===me&&ke(Zt)),r!==a){for(n=[],K.test(t.charAt(le))?(o=t.charAt(le),le++):(o=a,0===me&&ke(te));o!==a;)n.push(o),K.test(t.charAt(le))?(o=t.charAt(le),le++):(o=a,0===me&&ke(te));fe=e,e=ce()}else le=e,e=a;return e}function Pe(){var e,r,n;if(e=le,r=[],K.test(t.charAt(le))?(n=t.charAt(le),le++):(n=a,0===me&&ke(te)),n!==a)for(;n!==a;)r.push(n),K.test(t.charAt(le))?(n=t.charAt(le),le++):(n=a,0===me&&ke(te));else r=a;return r!==a&&(fe=e,r=ce()),e=r}function Me(){var e,r;return e=le,"**"===t.substr(le,2)?(r="**",le+=2):(r=a,0===me&&ke(ee)),r!==a&&(fe=e,r="^"),(e=r)===a&&(42===t.charCodeAt(le)?(e="*",le++):(e=a,0===me&&ke(re)),e===a&&(94===t.charCodeAt(le)?(e="^",le++):(e=a,0===me&&ke(ne)),e===a&&(37===t.charCodeAt(le)?(e="%",le++):(e=a,0===me&&ke(oe)),e===a&&(47===t.charCodeAt(le)?(e="/",le++):(e=a,0===me&&ke(ie)),e===a&&(43===t.charCodeAt(le)?(e="+",le++):(e=a,0===me&&ke(ae)),e===a&&(45===t.charCodeAt(le)?(e="-",le++):(e=a,0===me&&ke(Wt)))))))),e}function Fe(){var e,r;for(me++,e=[],L.test(t.charAt(le))?(r=t.charAt(le),le++):(r=a,0===me&&ke(se));r!==a;)e.push(r),L.test(t.charAt(le))?(r=t.charAt(le),le++):(r=a,0===me&&ke(se));return me--,r=a,0===me&&ke(ue),e}if((r=l())!==a&&le===t.length)return r;throw r!==a&&le<t.length&&ke({type:"end"}),n=ye,o=pe<t.length?t.charAt(pe):null,i=pe<t.length?we(pe,pe+1):we(pe,pe),new zt(zt.buildMessage(n,o),n,o,i)}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(zt,Error),zt.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<t.length;r++)if(t[r].source===this.location.source){n=t[r].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,i=this.location.source+":"+o.line+":"+o.column;if(n){var a=this.location.end,u=Ut("",o.line.toString().length),s=n[o.line-1],c=o.line===a.line?a.column:s.length+1;e+="\n --\x3e "+i+"\n"+u+" |\n"+o.line+" | "+s+"\n"+u+" | "+Ut("",o.column-1)+Ut("",c-o.column,"^")}else e+="\n at "+i}return e},zt.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?i(t[0])+"-"+i(t[1]):i(t)}));return"["+(t.inverted?"^":"")+e+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=t.map(a);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."};var Kt=function(){function t(){o(this,t)}return a(t,null,[{key:"parse",value:function(t){if(!t)throw new R("notation");if("string"!=typeof t)throw new TypeError("Notation must be a string");return $t(t)}}]),t}(),Lt=Object.freeze({BASE_64:1,JSON:0,OBJECT:2}),Xt=Symbol("notation"),Ht=Symbol("maxTotal"),Qt=Symbol("minTotal"),Wt=Symbol("expressions"),Yt=Symbol("roll-method"),Zt=Symbol("rolls"),te=Symbol("set-rolls"),ee=Symbol("total"),re=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return parseFloat(parseFloat("".concat(t)).toFixed(e||0))}(t.calculationValue,2)},ne=function(){function t(e){if(o(this,t),!e)throw new R("notation");if(this[Wt]=[],e instanceof Object&&!Array.isArray(e)){if(!e.notation)throw new R("notation");if("string"!=typeof e.notation)throw new C(e.notation);e.rolls&&this[te](e.rolls),this[Xt]=e.notation,this[Wt]=Kt.parse(this.notation),this.hasRolls()||this.roll()}else{if("string"!=typeof e)throw new C(e);this[Xt]=e,this[Wt]=Kt.parse(this.notation),this.roll()}}return a(t,[{key:"averageTotal",get:function(){return(this.maxTotal+this.minTotal)/2}},{key:"maxTotal",get:function(){if(!this.hasExpressions())return 0;if(!this[Ht]){var t=this[Yt](_.max);this[Ht]=re(t)}return this[Ht]}},{key:"minTotal",get:function(){if(!this.hasExpressions())return 0;if(!this[Qt]){var t=this[Yt](_.min);this[Qt]=re(t)}return this[Qt]}},{key:"notation",get:function(){return this[Xt]}},{key:"output",get:function(){var t="".concat(this.notation,": ");return this.hasRolls()?t+="".concat(this[Zt]," = ").concat(this.total):t+="No dice rolled",t}},{key:"rolls",get:function(){return this[Zt]?this[Zt].results:[]}},{key:"total",get:function(){return!this[ee]&&this.hasRolls()&&(this[ee]=re(this[Zt])),this[ee]||0}},{key:"export",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lt.JSON;switch(t){case Lt.BASE_64:return btoa(this.export(Lt.JSON));case Lt.JSON:return JSON.stringify(this);case Lt.OBJECT:return JSON.parse(this.export(Lt.JSON));default:throw new TypeError('Invalid export format "'.concat(t,'"'))}}},{key:"hasExpressions",value:function(){return this[Wt]&&this[Wt].length>0}},{key:"hasRolls",value:function(){return this.hasExpressions()&&this.rolls.length>0}},{key:"roll",value:function(){return this[ee]=0,this[Zt]=this[Yt](),this.rolls}},{key:"toJSON",value:function(){return{averageTotal:this.averageTotal,maxTotal:this.maxTotal,minTotal:this.minTotal,notation:this.notation,output:this.output,rolls:this.rolls,total:this.total,type:"dice-roll"}}},{key:"toString",value:function(){return this.output}},{key:Yt,value:function(t){var e;t&&(e=q.engine,q.engine=t);var r=new At(this[Wt].map((function(t){return t instanceof ht||t instanceof Gt?t.roll():t})).filter((function(t){return!!t||0===t})));return t&&(q.engine=e),r}},{key:te,value:function(t){if(t instanceof At)this[Zt]=t;else if(t instanceof ot)this[Zt]=new At([t]);else{if(!Array.isArray(t))throw new TypeError("Rolls must be a valid result object, or an array");this[Zt]=new At(t.map((function(t){if(t instanceof At||t instanceof ot)return t;if(Array.isArray(t))return new ot(t);if("object"===n(t)){if(Array.isArray(t.results))return new At(t.results,t.modifiers||[],t.isRollGroup||!1,"boolean"!=typeof t.useInTotal||t.useInTotal);if(Array.isArray(t.rolls))return new ot(t.rolls)}return t})))}}}],[{key:"import",value:function(e){if(e){if(Vt(e))return t.import(JSON.parse(e));if(qt(e))return t.import(atob(e));if("object"===n(e))return new t(e);throw new O(e)}throw new R("data")}}]),t}(),oe=Symbol("log"),ie=function(){function t(e){o(this,t),this[oe]=[],e&&this.import(e)}return a(t,[{key:"log",get:function(){return this[oe]||[]}},{key:"output",get:function(){return this.log.join("; ")}},{key:"total",get:function(){return this.log.reduce((function(t,e){return t+e.total}),0)}},{key:"clearLog",value:function(){this[oe].length=0}},{key:"export",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lt.JSON;switch(t){case Lt.BASE_64:return btoa(this.export(Lt.JSON));case Lt.JSON:return JSON.stringify(this);case Lt.OBJECT:return JSON.parse(this.export(Lt.JSON));default:throw new TypeError('Invalid export format "'.concat(t,'"'))}}},{key:"import",value:function(t){var e=this;if(t){if(Vt(t))return this.import(JSON.parse(t));if(qt(t))return this.import(atob(t));if("object"===n(t)){var r=t.log||null;if(!t.log&&Array.isArray(t)&&t.length&&(r=t),r&&Array.isArray(r))r.forEach((function(t){e[oe].push(ne.import(t))}));else if(r)throw new TypeError("log must be an array");return this.log}throw new O(t)}throw new R("data")}},{key:"roll",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=r.filter(Boolean);if(0===o.length)throw new R("notations");var i=o.map((function(e){var r=new ne(e);return t[oe].push(r),r}));return i.length>1?i:i[0]}},{key:"toJSON",value:function(){return{log:this.log,output:this.output,total:this.total,type:"dice-roller"}}},{key:"toString",value:function(){return this.output}}],[{key:"import",value:function(e){var r=new t;return r.import(e),r}}]),t}();t.ComparePoint=G,t.Dice=mt,t.DiceRoll=ne,t.DiceRoller=ie,t.Exceptions=N,t.Modifiers=_t,t.NumberGenerator=V,t.Parser=Kt,t.Results=It,t.RollGroup=Gt,t.exportFormats=Lt,Object.defineProperty(t,"__esModule",{value:!0})}));